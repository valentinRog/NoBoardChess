(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function y(){}function Ze(n){return n&&typeof n=="object"&&typeof n.then=="function"}function He(n){return n()}function Ee(){return Object.create(null)}function re(n){n.forEach(He)}function Ye(n){return typeof n=="function"}function J(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let he;function We(n,e){return he||(he=document.createElement("a")),he.href=e,n===he.href}function et(n){return Object.keys(n).length===0}function tt(n){return n==null?"":n}function m(n,e){n.appendChild(e)}function T(n,e,t){n.insertBefore(e,t||null)}function I(n){n.parentNode.removeChild(n)}function Q(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function g(n){return document.createElement(n)}function D(n){return document.createTextNode(n)}function A(){return D(" ")}function st(){return D("")}function V(n,e,t,s){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t,s)}function _(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function it(n){return Array.from(n.childNodes)}function ie(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function te(n,e,t){n.classList[t?"add":"remove"](e)}let le;function U(n){le=n}function Xe(){if(!le)throw new Error("Function called outside component initialization");return le}function nt(n){Xe().$$.on_mount.push(n)}const oe=[],ce=[],pe=[],_e=[],rt=Promise.resolve();let we=!1;function ot(){we||(we=!0,rt.then(Se))}function ke(n){pe.push(n)}function ye(n){_e.push(n)}const ge=new Set;let ue=0;function Se(){const n=le;do{for(;ue<oe.length;){const e=oe[ue];ue++,U(e),at(e.$$)}for(U(null),oe.length=0,ue=0;ce.length;)ce.pop()();for(let e=0;e<pe.length;e+=1){const t=pe[e];ge.has(t)||(ge.add(t),t())}pe.length=0}while(oe.length);for(;_e.length;)_e.pop()();we=!1,ge.clear(),U(n)}function at(n){if(n.fragment!==null){n.update(),re(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(ke)}}const fe=new Set;let X;function me(){X={r:0,c:[],p:X}}function ve(){X.r||re(X.c),X=X.p}function x(n,e){n&&n.i&&(fe.delete(n),n.i(e))}function F(n,e,t,s){if(n&&n.o){if(fe.has(n))return;fe.add(n),X.c.push(()=>{fe.delete(n),s&&(t&&n.d(1),s())}),n.o(e)}else s&&s()}function Ie(n,e){const t=e.token={};function s(i,o,r,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;r!==void 0&&(l=l.slice(),l[r]=a);const c=i&&(e.current=i)(l);let h=!1;e.block&&(e.blocks?e.blocks.forEach((f,u)=>{u!==o&&f&&(me(),F(f,1,1,()=>{e.blocks[u]===f&&(e.blocks[u]=null)}),ve())}):e.block.d(1),c.c(),x(c,1),c.m(e.mount(),e.anchor),h=!0),e.block=c,e.blocks&&(e.blocks[o]=c),h&&Se()}if(Ze(n)){const i=Xe();if(n.then(o=>{U(i),s(e.then,1,e.value,o),U(null)},o=>{if(U(i),s(e.catch,2,e.error,o),U(null),!e.hasCatch)throw o}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,n),!0;e.resolved=n}}function lt(n,e,t){const s=e.slice(),{resolved:i}=n;n.current===n.then&&(s[n.value]=i),n.current===n.catch&&(s[n.error]=i),n.block.p(s,t)}function qe(n,e,t){const s=n.$$.props[e];s!==void 0&&(n.$$.bound[s]=t,t(n.$$.ctx[s]))}function K(n){n&&n.c()}function $(n,e,t,s){const{fragment:i,on_mount:o,on_destroy:r,after_update:a}=n.$$;i&&i.m(e,t),s||ke(()=>{const l=o.map(He).filter(Ye);r?r.push(...l):re(l),n.$$.on_mount=[]}),a.forEach(ke)}function H(n,e){const t=n.$$;t.fragment!==null&&(re(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ct(n,e){n.$$.dirty[0]===-1&&(oe.push(n),ot(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Z(n,e,t,s,i,o,r,a=[-1]){const l=le;U(n);const c=n.$$={fragment:null,ctx:null,props:o,update:y,not_equal:i,bound:Ee(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Ee(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};r&&r(c.root);let h=!1;if(c.ctx=t?t(n,e.props||{},(f,u,...d)=>{const b=d.length?d[0]:u;return c.ctx&&i(c.ctx[f],c.ctx[f]=b)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](b),h&&ct(n,f)),u}):[],c.update(),h=!0,re(c.before_update),c.fragment=s?s(c.ctx):!1,e.target){if(e.hydrate){const f=it(e.target);c.fragment&&c.fragment.l(f),f.forEach(I)}else c.fragment&&c.fragment.c();e.intro&&x(n.$$.fragment),$(n,e.target,e.anchor,e.customElement),Se()}U(l)}class ee{$destroy(){H(this,1),this.$destroy=y}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!et(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ht="/assets/bB.4ad35327.svg",ut="/assets/bK.470b3ff1.svg",dt="/assets/bN.147a1c46.svg",pt="/assets/bP.02f7ecfe.svg",ft="/assets/bQ.cc8f0224.svg",mt="/assets/bR.f9b05d72.svg",vt="/assets/wB.ea0a664a.svg",gt="/assets/wK.fe4a8d94.svg",bt="/assets/wN.e0c94b20.svg",_t="/assets/wP.93fed888.svg",wt="/assets/wQ.461e7e3d.svg",kt="/assets/wR.afb9d215.svg";function Ce(n,e,t){const s=n.slice();return s[3]=e[t],s}function Te(n,e,t){const s=n.slice();return s[6]=e[t],s}function Me(n,e,t){const s=n.slice();return s[9]=e[t],s}function xe(n){let e,t=n[9]+"",s;return{c(){e=g("li"),s=D(t),_(e,"class","svelte-ddj68r")},m(i,o){T(i,e,o),m(e,s)},p:y,d(i){i&&I(e)}}}function Le(n){let e,t,s,i,o,r=n[3].pieces[n[6]],a=[];for(let l=0;l<r.length;l+=1)a[l]=xe(Me(n,r,l));return{c(){e=g("div"),t=g("img"),i=A(),o=g("ul");for(let l=0;l<a.length;l+=1)a[l].c();We(t.src,s=n[0][n[6]])||_(t,"src",s),_(t,"alt","yo"),_(t,"class","svelte-ddj68r"),_(o,"class","svelte-ddj68r"),_(e,"class",n[6])},m(l,c){T(l,e,c),m(e,t),m(e,i),m(e,o);for(let h=0;h<a.length;h+=1)a[h].m(o,null)},p(l,c){if(c&2){r=l[3].pieces[l[6]];let h;for(h=0;h<r.length;h+=1){const f=Me(l,r,h);a[h]?a[h].p(f,c):(a[h]=xe(f),a[h].c(),a[h].m(o,null))}for(;h<a.length;h+=1)a[h].d(1);a.length=r.length}},d(l){l&&I(e),Q(a,l)}}}function ze(n){let e,t,s=Object.keys(n[3].pieces),i=[];for(let o=0;o<s.length;o+=1)i[o]=Le(Te(n,s,o));return{c(){e=g("div");for(let o=0;o<i.length;o+=1)i[o].c();t=A(),_(e,"class",n[3].color+" container svelte-ddj68r")},m(o,r){T(o,e,r);for(let a=0;a<i.length;a+=1)i[a].m(e,null);m(e,t)},p(o,r){if(r&3){s=Object.keys(o[3].pieces);let a;for(a=0;a<s.length;a+=1){const l=Te(o,s,a);i[a]?i[a].p(l,r):(i[a]=Le(l),i[a].c(),i[a].m(e,t))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(o){o&&I(e),Q(i,o)}}}function yt(n){let e,t=n[1],s=[];for(let i=0;i<t.length;i+=1)s[i]=ze(Ce(n,t,i));return{c(){e=g("div");for(let i=0;i<s.length;i+=1)s[i].c();_(e,"id","pieces"),_(e,"class","svelte-ddj68r")},m(i,o){T(i,e,o);for(let r=0;r<s.length;r+=1)s[r].m(e,null)},p(i,[o]){if(o&3){t=i[1];let r;for(r=0;r<t.length;r+=1){const a=Ce(i,t,r);s[r]?s[r].p(a,o):(s[r]=ze(a),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},i:y,o:y,d(i){i&&I(e),Q(s,i)}}}function St(n,e,t){let{pieces:s}=e;const i={b:ht,k:ut,n:dt,p:pt,q:ft,r:mt,B:vt,K:gt,N:bt,P:_t,Q:wt,R:kt};let o=[{color:"white",pieces:Object.fromEntries(Object.entries(s).filter(([r,a])=>r===r.toUpperCase()))},{color:"black",pieces:Object.fromEntries(Object.entries(s).filter(([r,a])=>r===r.toLowerCase()))}];return n.$$set=r=>{"pieces"in r&&t(2,s=r.pieces)},[i,o,s]}class qt extends ee{constructor(e){super(),Z(this,e,St,yt,J,{pieces:2})}}function Pt(n){let e,t,s,i,o;return{c(){e=g("div"),t=g("strong"),s=D(n[3]),_(e,"class",tt(n[4])+" svelte-70sg40"),te(e,"active",n[0]===n[1]+1),te(e,"failed",n[2]),te(e,"pointer",n[0]!==void 0)},m(r,a){T(r,e,a),m(e,t),m(t,s),i||(o=V(e,"click",n[6]),i=!0)},p(r,[a]){a&8&&ie(s,r[3]),a&3&&te(e,"active",r[0]===r[1]+1),a&4&&te(e,"failed",r[2]),a&1&&te(e,"pointer",r[0]!==void 0)},i:y,o:y,d(r){r&&I(e),i=!1,o()}}}function Et(n,e,t){let{puzzle:s}=e,{moveIndex:i}=e,{activeFenIndex:o=void 0}=e,{failed:r=!1}=e,a="";const l=s.fens[i+1].split(" ")[1],c=u=>Number(u.split(" ").at(-1)),h=1+c(s.fens[i+1])-c(s.fens[1]);a+=String(h)+(l==="w"?".":"..."),a+=s.san_moves[i];const f=()=>{o!==void 0&&t(0,o=i+1)};return n.$$set=u=>{"puzzle"in u&&t(5,s=u.puzzle),"moveIndex"in u&&t(1,i=u.moveIndex),"activeFenIndex"in u&&t(0,o=u.activeFenIndex),"failed"in u&&t(2,r=u.failed)},[o,i,r,a,l,s,f]}class Qe extends ee{constructor(e){super(),Z(this,e,Et,Pt,J,{puzzle:5,moveIndex:1,activeFenIndex:0,failed:2})}}function Ae(n,e,t){const s=n.slice();return s[9]=e[t],s}function Oe(n,e,t){const s=n.slice();return s[12]=e[t],s[14]=t,s}function Fe(n){let e,t,s,i;return t=new Qe({props:{puzzle:n[0],moveIndex:n[14]}}),{c(){e=g("div"),K(t.$$.fragment),s=A(),_(e,"class","svelte-ws599m")},m(o,r){T(o,e,r),$(t,e,null),m(e,s),i=!0},p(o,r){const a={};r&1&&(a.puzzle=o[0]),t.$set(a)},i(o){i||(x(t.$$.fragment,o),i=!0)},o(o){F(t.$$.fragment,o),i=!1},d(o){o&&I(e),H(t)}}}function De(n){let e,t=n[9]+"",s,i,o;return{c(){e=g("button"),s=D(t)},m(r,a){T(r,e,a),m(e,s),i||(o=V(e,"click",function(){Ye(n[4](n[9]))&&n[4](n[9]).apply(this,arguments)}),i=!0)},p(r,a){n=r,a&4&&t!==(t=n[9]+"")&&ie(s,t)},d(r){r&&I(e),i=!1,o()}}}function It(n){let e,t,s,i,o,r,a,l=n[3],c=[];for(let d=0;d<l.length;d+=1)c[d]=Fe(Oe(n,l,d));const h=d=>F(c[d],1,1,()=>{c[d]=null});let f=n[2],u=[];for(let d=0;d<f.length;d+=1)u[d]=De(Ae(n,f,d));return{c(){e=g("div"),t=g("div");for(let d=0;d<c.length;d+=1)c[d].c();s=A(),i=g("div"),o=D(n[1]),r=A();for(let d=0;d<u.length;d+=1)u[d].c();_(t,"id","line"),_(t,"class","container svelte-ws599m")},m(d,b){T(d,e,b),m(e,t);for(let v=0;v<c.length;v+=1)c[v].m(t,null);m(e,s),m(e,i),m(i,o),m(e,r);for(let v=0;v<u.length;v+=1)u[v].m(e,null);a=!0},p(d,[b]){if(b&9){l=d[3];let v;for(v=0;v<l.length;v+=1){const O=Oe(d,l,v);c[v]?(c[v].p(O,b),x(c[v],1)):(c[v]=Fe(O),c[v].c(),x(c[v],1),c[v].m(t,null))}for(me(),v=l.length;v<c.length;v+=1)h(v);ve()}if((!a||b&2)&&ie(o,d[1]),b&20){f=d[2];let v;for(v=0;v<f.length;v+=1){const O=Ae(d,f,v);u[v]?u[v].p(O,b):(u[v]=De(O),u[v].c(),u[v].m(e,null))}for(;v<u.length;v+=1)u[v].d(1);u.length=f.length}},i(d){if(!a){for(let b=0;b<l.length;b+=1)x(c[b]);a=!0}},o(d){c=c.filter(Boolean);for(let b=0;b<c.length;b+=1)F(c[b]);a=!1},d(d){d&&I(e),Q(c,d),Q(u,d)}}}function Ct(n,e,t){let s,i,{puzzle:o}=e,{game:r}=e;r.failedMoveIndex=void 0;let a=1,l="";const c=()=>{let u=[];return a<o.legal_san_moves.length&&l!==s&&(o.legal_san_moves[a].forEach(d=>{d.startsWith(l)&&!u.includes(d[l.length])&&(u=[...u,d[l.length]])}),u=u.sort()),u};let h=c();const f=u=>()=>{if(u===s[l.length]){for(t(1,l+=u);c().length===1;)t(1,l+=c()[0]);l===s&&(t(6,a+=2),t(1,l=""),a>o.san_moves.length-1&&t(5,r.guessing=!1,r)),t(2,h=c())}else t(5,r.failedMoveIndex=a,r),t(5,r.fails++,r),t(5,r.guessing=!1,r)};return n.$$set=u=>{"puzzle"in u&&t(0,o=u.puzzle),"game"in u&&t(5,r=u.game)},n.$$.update=()=>{n.$$.dirty&65&&(s=o.san_moves[a]),n.$$.dirty&65&&t(3,i=o.san_moves.slice(0,a))},[o,l,h,i,f,r,a]}class Tt extends ee{constructor(e){super(),Z(this,e,Ct,It,J,{puzzle:0,game:5})}}const Mt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",xt="8/8/8/8/8/8/8/8",ae={start:Mt,empty:xt};class E{constructor(e=void 0){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=ae.empty){let t;e==="start"?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty"),t=ae.start):e==="empty"||e===void 0?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty"),t=ae.empty):t=e;const s=t.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let i=0;i<8;i++){const o=s[7-i].replace(/\d/g,r=>{const a=parseInt(r);let l="";for(let c=0;c<a;c++)l+="-";return l});for(let r=0;r<8;r++){const a=o.substring(r,r+1);let l=null;a!=="-"&&(a.toUpperCase()===a?l=`w${a.toLowerCase()}`:l=`b${a}`),this.squares[i*8+r]=l}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){const o=this.squares[t*8+i];if(!o)s++;else{s>0&&(e[7-t]+=s,s=0);const r=o.substring(0,1),a=o.substring(1,2);r==="w"?e[7-t]+=a.toUpperCase():e[7-t]+=a}}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(e=["k","q","r","b","n","p"]){const t=[],s=(i,o)=>e.indexOf(i.name)-e.indexOf(o.name);for(let i=0;i<64;i++){const o=this.squares[i];o&&t.push({name:o.charAt(1),color:o.charAt(0),position:E.indexToSquare(i)})}return e&&t.sort(s),t}movePiece(e,t){if(!this.squares[E.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[E.squareToIndex(t)]=this.squares[E.squareToIndex(e)],this.squares[E.squareToIndex(e)]=void 0}setPiece(e,t){this.squares[E.squareToIndex(e)]=t}getPiece(e){return this.squares[E.squareToIndex(e)]}static squareToIndex(e){const t=e.substring(0,1).charCodeAt(0)-97,s=e.substring(1,2)-1;return 8*s+t}static indexToSquare(e){const t=String.fromCharCode(e%8+97),s=Math.floor(e/8)+1;return t+s}clone(){const e=new E;return e.squares=this.squares.slice(0),e}}function Ke(){let n,e;const t=new Promise(function(s,i){n=s,e=i});return t.resolve=n,t.reject=e,t}class Lt{constructor(){this.position=new E,this.orientation=void 0,this.markers=[],this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.inputEnabled=!1,this.squareSelectEnabled=!1,this.extensionPoints={},this.moveInputProcess=Ke().resolve()}setPosition(e,t=!1){this.position=new E(e,t)}movePiece(e,t,s=!1){const i=this._position.clone();i.animated=s;const o=i.getPiece(e);o||console.error("no piece on",e),i.setPiece(e,void 0),i.setPiece(t,o),this._position=i}setPiece(e,t,s=!1){const i=this._position.clone();i.animated=s,i.setPiece(e,t),this._position=i}addMarker(e,t){this.markers.push({square:e,type:t})}removeMarkers(e=void 0,t=void 0){!e&&!t?this.markers=[]:this.markers=this.markers.filter(s=>{if(t){if(e){if(s.type===t&&e===s.square)return!1}else if(s.type===t)return!1}else if(e===s.square)return!1;return!0})}invokeExtensionPoints(e,t={}){const s=this.extensionPoints[e],i=Object.assign({},t);if(i.extensionPoint=e,s)for(const o of s)setTimeout(()=>{o(i)})}}const p={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},de={secondClick:"secondClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},Ne=4;class zt{constructor(e,t,s,i){this.view=e,this.chessboard=e.chessboard,this.moveInputStartedCallback=o=>{const r=t(o);return r&&(this.chessboard.state.moveInputProcess=Ke()),r},this.validateMoveInputCallback=(o,r)=>{const a=s(o,r);return this.chessboard.state.moveInputProcess.resolve(a),a},this.moveInputCanceledCallback=(o,r,a)=>{i(o,r,a),this.chessboard.state.moveInputProcess.resolve()},this.setMoveInputState(p.waitForInputStart)}setMoveInputState(e,t=void 0){const s=this.moveInputState;switch(this.moveInputState=e,e){case p.waitForInputStart:break;case p.pieceClickedThreshold:if(p.waitForInputStart!==s&&p.clickTo!==s)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.fromSquare=t.square,this.toSquare=void 0,this.movedPiece=t.piece,this.updateStartEndMarkers(),this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener)if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("event type");else throw Error("_pointerMoveListener or _pointerUpListener");break;case p.clickTo:this.draggablePiece&&(P.removeElement(this.draggablePiece),this.draggablePiece=void 0),s===p.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case p.secondClickThreshold:if(p.clickTo!==s)throw new Error("moveInputState");this.startPoint=t.point;break;case p.dragTo:if(p.pieceClickedThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case p.clickDragTo:if(p.secondClickThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case p.moveDone:if([p.dragTo,p.clickTo,p.clickDragTo].indexOf(s)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?s===p.clickTo?this.chessboard.movePiece(this.fromSquare,this.toSquare,!0).then(()=>{this.setMoveInputState(p.reset)}):this.chessboard.movePiece(this.fromSquare,this.toSquare,!1).then(()=>{this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(p.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(p.reset));break;case p.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=void 0,this.toSquare=void 0,this.movedPiece=void 0,this.updateStartEndMarkers(),this.draggablePiece&&(P.removeElement(this.draggablePiece),this.draggablePiece=void 0),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.setMoveInputState(p.waitForInputStart);break;default:throw Error(`moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece exists");this.draggablePiece=P.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,s=P.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),i=this.view.squareHeight/this.chessboard.props.sprite.size,o=this.draggablePiece.createSVGTransform();o.setScale(i,i),s.transform.baseVal.appendItem(o)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(e.type==="mousedown"&&e.button===0||e.type==="touchstart"){const t=e.target.getAttribute("data-square");if(t){const s=this.chessboard.getPiece(t);let i;if(s&&(i=s?s.substring(0,1):void 0,(i==="w"&&this.chessboard.state.inputWhiteEnabled||i==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==p.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&i==="w"||this.chessboard.state.inputBlackEnabled&&i==="b"){let o;if(e.type==="mousedown"?o={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(o={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===p.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(p.pieceClickedThreshold,{square:t,piece:s,point:o,type:e.type});else if(this.moveInputState===p.clickTo)if(t===this.fromSquare)this.setMoveInputState(p.secondClickThreshold,{square:t,piece:s,point:o,type:e.type});else{const r=this.chessboard.getPiece(t),a=r?r.substring(0,1):void 0,l=this.chessboard.getPiece(this.fromSquare),c=l?l.substring(0,1):void 0;i&&c===a?(this.moveInputCanceledCallback(de.clickedAnotherPiece,this.fromSquare,t),this.moveInputStartedCallback(t)?this.setMoveInputState(p.pieceClickedThreshold,{square:t,piece:r,point:o,type:e.type}):this.setMoveInputState(p.reset)):this.setMoveInputState(p.moveDone,{square:t})}}}}}onPointerMove(e){let t,s,i,o,r;if(e.type==="mousemove"?(i=e.clientX,o=e.clientY,t=e.pageX,s=e.pageY,r=e.target):e.type==="touchmove"&&(i=e.touches[0].clientX,o=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,r=document.elementFromPoint(i,o)),this.moveInputState===p.pieceClickedThreshold||this.moveInputState===p.secondClickThreshold)(Math.abs(this.startPoint.x-i)>Ne||Math.abs(this.startPoint.y-o)>Ne)&&(this.moveInputState===p.secondClickThreshold?this.setMoveInputState(p.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(p.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled&&this.moveDraggablePiece(t,s));else if(this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo||this.moveInputState===p.clickTo){if(r&&r.getAttribute&&r.parentElement===this.view.boardGroup){const a=r.getAttribute("data-square");a!==this.fromSquare&&a!==this.toSquare?(this.toSquare=a,this.updateStartEndMarkers()):a===this.fromSquare&&this.toSquare!==void 0&&(this.toSquare=void 0,this.updateStartEndMarkers())}else this.toSquare!==void 0&&(this.toSquare=void 0,this.updateStartEndMarkers());this.view.chessboard.state.inputEnabled&&(this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo)&&this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const s=t.getAttribute("data-square");if(s)this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo?this.fromSquare===s?this.moveInputState===p.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(de.draggedBack,s,s),this.setMoveInputState(p.reset)):this.setMoveInputState(p.clickTo,{square:s}):this.setMoveInputState(p.moveDone,{square:s}):this.moveInputState===p.pieceClickedThreshold?this.setMoveInputState(p.clickTo,{square:s}):this.moveInputState===p.secondClickThreshold&&(this.setMoveInputState(p.reset),this.moveInputCanceledCallback(de.secondClick,s,s));else{this.view.redrawPieces();const i=this.fromSquare;this.setMoveInputState(p.reset),this.moveInputCanceledCallback(de.movedOutOfBoard,i,void 0)}}else this.view.redrawPieces(),this.setMoveInputState(p.reset)}updateStartEndMarkers(){this.chessboard.props.style.moveFromMarker&&this.chessboard.state.removeMarkers(void 0,this.chessboard.props.style.moveFromMarker),this.chessboard.props.style.moveToMarker&&this.chessboard.state.removeMarkers(void 0,this.chessboard.props.style.moveToMarker),this.chessboard.props.style.moveFromMarker&&this.fromSquare&&this.chessboard.state.addMarker(this.fromSquare,this.chessboard.props.style.moveFromMarker),this.chessboard.props.style.moveToMarker&&this.toSquare&&this.chessboard.state.addMarker(this.toSquare,this.chessboard.props.style.moveToMarker),this.view.drawMarkers()}reset(){this.setMoveInputState(p.reset)}destroy(){this.reset()}}const N={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",moveInputStateChanged:"moveInput",destroy:"destroy",redrawBoard:"redrawBoard"};class At{constructor(e){this.chessboard=e,this.moveInput=new zt(this,this.moveInputStartedCallback.bind(this),this.validateMoveInputCallback.bind(this),this.moveInputCanceledCallback.bind(this)),e.props.sprite.cache&&this.cacheSpriteToDiv("chessboardSpriteCache",this.chessboard.props.sprite.url),this.context=document.createElement("div"),this.chessboard.context.appendChild(this.context),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.pointerDownListener=this.pointerDownHandler.bind(this),this.pointerDownListener=this.pointerDownHandler.bind(this),this.context.addEventListener("mousedown",this.pointerDownListener),this.context.addEventListener("touchstart",this.pointerDownListener),this.createSvgAndGroups(),this.updateMetrics(),this.handleResize(),this.redrawBoard()}pointerDownHandler(e){this.moveInput.onPointerDown(e)}destroy(){this.moveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),this.animationQueue=[],this.currentAnimation&&cancelAnimationFrame(this.currentAnimation.frameHandle),P.removeElement(this.svg)}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const s=document.createElement("div");s.style.display="none",s.id=e,document.body.appendChild(s);const i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=P.createSvg(this.context);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=P.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=P.addElement(this.svg,"g",{class:"coordinates"}),this.markersLayer=P.addElement(this.svg,"g",{class:"markers-layer"}),this.markersGroup=P.addElement(this.markersLayer,"g",{class:"markers"}),this.piecesLayer=P.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=P.addElement(this.piecesLayer,"g",{class:"pieces"})}updateMetrics(){this.width=this.context.clientWidth,this.height=this.context.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===se.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===se.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/this.chessboard.props.sprite.size,this.scalingY=this.squareHeight/this.chessboard.props.sprite.size,this.pieceXTranslate=this.squareWidth/2-this.chessboard.props.sprite.size*this.scalingY/2}handleResize(){this.context.style.width=this.chessboard.context.clientWidth+"px",this.context.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.context.clientWidth!==this.width||this.context.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.redrawSquares(),this.drawCoordinates(),this.drawMarkers(),this.chessboard.state.invokeExtensionPoints(N.redrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(P.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===se.frame){const t=this.borderSize;P.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const s=this.chessboard.state.orientation===W.white?t:63-t,o=`square ${(9*s&8)===0?"black":"white"}`,r=this.squareToPoint(E.indexToSquare(s)),a=P.addElement(this.boardGroup,"rect",{x:r.x,y:r.y,width:this.squareWidth,height:this.squareHeight});a.setAttribute("class",o),a.setAttribute("data-square",E.indexToSquare(s))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==se.frame;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.sprite.size*t)*this.scalingX,i=this.height-this.scalingY*3.5,o="coordinate file";e&&(s=s+this.scalingX*15.5,o+=t%2?" white":" black");const r=P.addElement(this.coordinatesGroup,"text",{class:o,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===W.white?r.textContent=String.fromCharCode(97+t):r.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,o="coordinate rank";e&&(o+=t%2?" black":" white",this.chessboard.props.style.borderType===se.frame?(s=s+this.scalingX*10,i=i-this.scalingY*15):(s=s+this.scalingX*2,i=i-this.scalingY*15));const r=P.addElement(this.coordinatesGroup,"text",{class:o,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===W.white?r.textContent=""+(8-t):r.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes);for(let s=0;s<64;s++){const i=e[s];i&&this.drawPiece(E.indexToSquare(s),i)}for(const s of t)this.piecesGroup.removeChild(s)}drawPiece(e,t){const s=P.addElement(this.piecesGroup,"g");s.setAttribute("data-piece",t),s.setAttribute("data-square",e);const i=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(i.x,i.y),s.transform.baseVal.appendItem(o);const r=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,a=P.addElement(s,"use",{href:`${r}#${t}`,class:"piece"}),l=this.svg.createSVGTransform();l.setTranslate(this.pieceXTranslate,0),a.transform.baseVal.appendItem(l);const c=this.svg.createSVGTransform();return c.setScale(this.scalingY,this.scalingY),a.transform.baseVal.appendItem(c),s}setPieceVisibility(e,t=!0){const s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(e.length<2)throw new Error("980e03");const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||console.warn("no piece on",e),t}drawMarkers(){for(;this.markersGroup.firstChild;)this.markersGroup.removeChild(this.markersGroup.firstChild);this.chessboard.state.markers.forEach(e=>{this.drawMarker(e)})}drawMarker(e){const t=P.addElement(this.markersGroup,"g");t.setAttribute("data-square",e.square);const s=this.squareToPoint(e.square),i=this.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);const o=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,r=P.addElement(t,"use",{href:`${o}#${e.type.slice}`,class:"marker "+e.type.class}),a=this.svg.createSVGTransform();return a.setScale(this.scalingX,this.scalingY),r.transform.baseVal.appendItem(a),t}enableMoveInput(e,t=void 0){t===W.white?this.chessboard.state.inputWhiteEnabled=!0:t===W.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.inputEnabled=!0,this.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(N.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.inputEnabled=!1,this.moveInputCallback=void 0,this.chessboard.state.invokeExtensionPoints(N.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:be.moveInputStarted,square:e};return this.chessboard.state.invokeExtensionPoints(N.moveInput,t),this.moveInputCallback?this.moveInputCallback(t):!0}validateMoveInputCallback(e,t){const s={chessboard:this.chessboard,type:be.validateMoveInput,squareFrom:e,squareTo:t};return this.chessboard.state.invokeExtensionPoints(N.moveInput,s),this.moveInputCallback?this.moveInputCallback(s):!0}moveInputCanceledCallback(e,t,s){const i={chessboard:this.chessboard,type:be.moveInputCanceled,reason:e,squareFrom:t,squareTo:s};this.chessboard.state.invokeExtensionPoints(N.moveInput,i),this.moveInputCallback&&this.moveInputCallback(i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled||this.chessboard.state.squareSelectEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===W.white?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){const t=E.squareToIndex(e);return this.indexToPoint(t)}}const Ge="http://www.w3.org/2000/svg";class P{static createSvg(e=void 0){let t=document.createElementNS(Ge,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s,i=void 0){let o=document.createElementNS(Ge,t);t==="use"&&(s["xlink:href"]=s.href);for(let r in s)if(s.hasOwnProperty(r))if(r.indexOf(":")!==-1){const a=r.split(":");o.setAttributeNS("http://www.w3.org/1999/"+a[0],a[1],s[r])}else o.setAttribute(r,s[r]);return i!==void 0?e.appendChild(o):e.insertBefore(o,i),o}static removeElement(e){e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}class Ot{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(!!e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const G={move:0,appear:1,disappear:2};class ne{constructor(e,t,s,i,o){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=o,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s)}static seekChanges(e,t){const s=[],i=[],o=[];for(let r=0;r<64;r++){const a=e[r],l=t[r];l!==a&&(l&&s.push({piece:l,index:r}),a&&i.push({piece:a,index:r}))}return s.forEach(r=>{let a=8,l;i.forEach(c=>{if(r.piece===c.piece){const h=ne.squareDistance(r.index,c.index);h<a&&(l=c,a=h)}}),l?(i.splice(i.indexOf(l),1),o.push({type:G.move,piece:r.piece,atIndex:l.index,toIndex:r.index})):o.push({type:G.appear,piece:r.piece,atIndex:r.index})}),i.forEach(r=>{o.push({type:G.disappear,piece:r.piece,atIndex:r.index})}),o}createAnimation(e,t){const s=ne.seekChanges(e,t),i=[];return s.forEach(o=>{const r={type:o.type};switch(o.type){case G.move:r.element=this.view.getPieceElement(E.indexToSquare(o.atIndex)),r.element.parentNode.appendChild(r.element),r.atPoint=this.view.indexToPoint(o.atIndex),r.toPoint=this.view.indexToPoint(o.toIndex);break;case G.appear:r.element=this.view.drawPiece(E.indexToSquare(o.atIndex),o.piece),r.element.style.opacity=0;break;case G.disappear:r.element=this.view.getPieceElement(E.indexToSquare(o.atIndex));break}i.push(r)}),i}animationStep(e){this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(o=>{o.type===G.disappear&&P.removeElement(o.element)}),this.callback();return}const s=Math.min(1,t/this.duration);let i=s<.5?2*s*s:-1+(4-2*s)*s;isNaN(i)&&(i=1),this.animatedElements.forEach(o=>{if(o.element)switch(o.type){case G.move:o.element.transform.baseVal.removeItem(0);const r=this.view.svg.createSVGTransform();r.setTranslate(o.atPoint.x+(o.toPoint.x-o.atPoint.x)*i,o.atPoint.y+(o.toPoint.y-o.atPoint.y)*i),o.element.transform.baseVal.appendItem(r);break;case G.appear:o.element.style.opacity=Math.round(i*100)/100;break;case G.disappear:o.element.style.opacity=Math.round((1-i)*100)/100;break}else console.warn("animatedItem has no element",o)})}static squareDistance(e,t){const s=e%8,i=Math.floor(e/8),o=t%8,r=Math.floor(t/8);return Math.max(Math.abs(r-i),Math.abs(o-s))}}class Ft extends Ot{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(i=>{let o=s?this.chessboard.props.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new ne(this.chessboard.view,e,t,s?o:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()})}))}async enqueueTurnBoard(e,t,s){return super.enqueue(()=>new Promise(i=>{const o=new E(ae.empty);let r=s?this.chessboard.props.animationDuration:0;this.queue.length>0&&(r=r/(1+Math.pow(this.queue.length/5,2))),new ne(this.chessboard.view,e,o,s?r:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(o.squares),new ne(this.chessboard.view,o,e,s?r:0,()=>{this.chessboard.view.redrawPieces(e.squares),i()})})}))}}const W={white:"w",black:"b"},be={moveStart:"moveInputStarted",moveInputStarted:"moveInputStarted",moveDone:"validateMoveInput",validateMoveInput:"validateMoveInput",moveCanceled:"moveInputCanceled",moveInputCanceled:"moveInputCanceled"},Be={primary:"primary",secondary:"secondary"},se={none:"none",thin:"thin",frame:"frame"},je={frame:{class:"marker-frame",slice:"markerFrame"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot"},circle:{class:"marker-circle",slice:"markerCircle"}};class Dt{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[];let s={position:ae.empty,orientation:W.white,responsive:!0,animationDuration:300,language:navigator.language.substring(0,2).toLowerCase(),style:{cssClass:"default",showCoordinates:!0,borderType:se.none,aspectRatio:1,moveFromMarker:je.frame,moveToMarker:je.frame},sprite:{url:"./assets/images/chessboard-sprite.svg",size:40,cache:!0},extensions:[]};this.props={},Object.assign(this.props,s),Object.assign(this.props,t),this.props.sprite=s.sprite,this.props.style=s.style,t.sprite&&Object.assign(this.props.sprite,t.sprite),t.style&&Object.assign(this.props.style,t.style),t.extensions&&(this.props.extensions=t.extensions),this.props.language!=="de"&&this.props.language!=="en"&&(this.props.language="en"),this.state=new Lt,this.view=new At(this),this.positionAnimationsQueue=new Ft(this),this.state.orientation=this.props.orientation;for(const i of this.props.extensions)this.extensions.push(new i.class(this,i.props));this.view.redrawBoard(),this.state.position=new E(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(N.positionChanged)}async setPiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(N.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(N.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e,t=!1){const s=this.state.position.clone(),i=new E(e);return s.getFen()!==i.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(N.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e,t=!1){const s=this.state.position.clone();if(this.boardTurning){console.log("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(N.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.state.addMarker(t,e),this.view.drawMarkers()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}const s=[];return this.state.markers.forEach(i=>{const o=i.square;(!t&&(!e||e===i.type)||!e&&t===o||e===i.type&&t===o)&&s.push({square:i.square,type:i.type})}),s}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.state.removeMarkers(t,e),this.view.drawMarkers()}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}enableSquareSelect(e){if(this.squareSelectListener){console.warn("squareSelectListener already existing");return}this.squareSelectListener=function(t){const s=t.target.getAttribute("data-square");if(t.type==="contextmenu"){t.preventDefault();return}e({chessboard:this,type:t.button===2?Be.secondary:Be.primary,square:s})},this.context.addEventListener("contextmenu",this.squareSelectListener),this.context.addEventListener("mouseup",this.squareSelectListener),this.context.addEventListener("touchend",this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(){this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}destroy(){this.state.invokeExtensionPoints(N.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0,this.squareSelectListener&&(this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener))}}const Nt="/assets/chessboard-sprite-staunty.485981d8.svg";function Ue(n,e,t){const s=n.slice();return s[11]=e[t],s[13]=t,s}function Gt(n){let e,t,s;return{c(){e=g("button"),e.textContent="restart"},m(i,o){T(i,e,o),t||(s=V(e,"click",n[5]),t=!0)},p:y,d(i){i&&I(e),t=!1,s()}}}function Bt(n){let e,t,s;return{c(){e=g("button"),e.textContent="next"},m(i,o){T(i,e,o),t||(s=V(e,"click",n[4]),t=!0)},p:y,d(i){i&&I(e),t=!1,s()}}}function Re(n){let e,t,s;function i(r){n[10](r)}let o={puzzle:n[1],moveIndex:n[13],failed:n[13]===n[0].failedMoveIndex};return n[2]!==void 0&&(o.activeFenIndex=n[2]),e=new Qe({props:o}),ce.push(()=>qe(e,"activeFenIndex",i)),{c(){K(e.$$.fragment)},m(r,a){$(e,r,a),s=!0},p(r,a){const l={};a&2&&(l.puzzle=r[1]),a&1&&(l.failed=r[13]===r[0].failedMoveIndex),!t&&a&4&&(t=!0,l.activeFenIndex=r[2],ye(()=>t=!1)),e.$set(l)},i(r){s||(x(e.$$.fragment,r),s=!0)},o(r){F(e.$$.fragment,r),s=!1},d(r){H(e,r)}}}function jt(n){let e,t,s,i,o,r,a,l,c,h,f,u,d,b,v,O,R,B,Y,j;function L(w,z){return w[0].fails<w[0].lives?Bt:Gt}let k=L(n),M=k(n),S=n[1].san_moves,q=[];for(let w=0;w<S.length;w+=1)q[w]=Re(Ue(n,S,w));const Je=w=>F(q[w],1,1,()=>{q[w]=null});return{c(){e=g("div"),M.c(),t=A(),s=g("div"),i=g("div"),o=g("div"),o.innerHTML='<div id="chessboard"></div>',r=A(),a=g("div"),l=g("button"),l.textContent="<<",c=A(),h=g("button"),h.textContent="<",f=A(),u=g("button"),u.textContent=">",d=A(),b=g("button"),b.textContent=">>",v=A(),O=g("div"),R=g("div");for(let w=0;w<q.length;w+=1)q[w].c();_(e,"id","next"),_(o,"class","container"),_(a,"id","controls"),_(a,"class","svelte-b1tgdv"),_(i,"id","board"),_(i,"class","svelte-b1tgdv"),_(R,"class","container"),_(O,"id","line"),_(s,"id","answer"),_(s,"class","svelte-b1tgdv")},m(w,z){T(w,e,z),M.m(e,null),T(w,t,z),T(w,s,z),m(s,i),m(i,o),m(i,r),m(i,a),m(a,l),m(a,c),m(a,h),m(a,f),m(a,u),m(a,d),m(a,b),m(s,v),m(s,O),m(O,R);for(let C=0;C<q.length;C+=1)q[C].m(R,null);B=!0,Y||(j=[V(l,"click",n[6]),V(h,"click",n[7]),V(u,"click",n[8]),V(b,"click",n[9])],Y=!0)},p(w,[z]){if(k===(k=L(w))&&M?M.p(w,z):(M.d(1),M=k(w),M&&(M.c(),M.m(e,null))),z&7){S=w[1].san_moves;let C;for(C=0;C<S.length;C+=1){const Pe=Ue(w,S,C);q[C]?(q[C].p(Pe,z),x(q[C],1)):(q[C]=Re(Pe),q[C].c(),x(q[C],1),q[C].m(R,null))}for(me(),C=S.length;C<q.length;C+=1)Je(C);ve()}},i(w){if(!B){for(let z=0;z<S.length;z+=1)x(q[z]);B=!0}},o(w){q=q.filter(Boolean);for(let z=0;z<q.length;z+=1)F(q[z]);B=!1},d(w){w&&I(e),M.d(),w&&I(t),w&&I(s),Q(q,w),Y=!1,re(j)}}}function Ut(n,e,t){let{puzzle:s}=e,{game:i}=e,o;nt(()=>{t(3,o=new Dt(document.getElementById("chessboard"),{position:s.fen,sprite:{url:Nt},style:{cssClass:"black-and-white"}}))});let r=0;const a=()=>{t(0,i.guessing=!0,i),t(0,i.level++,i)},l=()=>{t(0,i.guessing=!0,i),t(0,i.level=1,i),t(0,i.fails=0,i)},c=()=>{t(2,r=0)},h=()=>{r&&t(2,r--,r)},f=()=>{r<s.san_moves.length&&t(2,r++,r)},u=()=>{t(2,r=s.san_moves.length)};function d(b){r=b,t(2,r)}return n.$$set=b=>{"puzzle"in b&&t(1,s=b.puzzle),"game"in b&&t(0,i=b.game)},n.$$.update=()=>{n.$$.dirty&14&&o&&o.setPosition(s.fens[r],!0)},[i,s,r,o,a,l,c,h,f,u,d]}class Rt extends ee{constructor(e){super(),Z(this,e,Ut,jt,J,{puzzle:1,game:0})}}const Vt="/assets/heart.ae78b16e.svg";function Ve(n,e,t){const s=n.slice();return s[2]=e[t],s}function $e(n){let e,t;return{c(){e=g("img"),We(e.src,t=Vt)||_(e,"src",t),_(e,"alt","yo"),_(e,"class","svelte-w5o2qi")},m(s,i){T(s,e,i)},p:y,d(s){s&&I(e)}}}function $t(n){let e,t,s,i=n[1].level+"",o,r,a,l,c,h,f,u,d=n[0].elo+"",b,v,O,R,B=n[0].n_pieces+"",Y,j=Array(n[1].lives-n[1].fails),L=[];for(let k=0;k<j.length;k+=1)L[k]=$e(Ve(n,j,k));return{c(){e=g("div"),t=g("div"),s=D("#"),o=D(i),r=A(),a=g("div");for(let k=0;k<L.length;k+=1)L[k].c();l=A(),c=g("div"),h=g("ul"),f=g("li"),u=D("Rating: "),b=D(d),v=A(),O=g("li"),R=D("Number of pieces: "),Y=D(B),_(t,"id","level"),_(t,"class","svelte-w5o2qi"),_(a,"id","lives"),_(h,"class","svelte-w5o2qi"),_(e,"class","container svelte-w5o2qi")},m(k,M){T(k,e,M),m(e,t),m(t,s),m(t,o),m(e,r),m(e,a);for(let S=0;S<L.length;S+=1)L[S].m(a,null);m(e,l),m(e,c),m(c,h),m(h,f),m(f,u),m(f,b),m(h,v),m(h,O),m(O,R),m(O,Y)},p(k,[M]){if(M&2&&i!==(i=k[1].level+"")&&ie(o,i),M&2){j=Array(k[1].lives-k[1].fails);let S;for(S=0;S<j.length;S+=1){const q=Ve(k,j,S);L[S]?L[S].p(q,M):(L[S]=$e(),L[S].c(),L[S].m(a,null))}for(;S<L.length;S+=1)L[S].d(1);L.length=j.length}M&1&&d!==(d=k[0].elo+"")&&ie(b,d),M&1&&B!==(B=k[0].n_pieces+"")&&ie(Y,B)},i:y,o:y,d(k){k&&I(e),Q(L,k)}}}function Ht(n,e,t){let{puzzle:s}=e,{game:i}=e;return n.$$set=o=>{"puzzle"in o&&t(0,s=o.puzzle),"game"in o&&t(1,i=o.game)},[s,i]}class Yt extends ee{constructor(e){super(),Z(this,e,Ht,$t,J,{puzzle:0,game:1})}}function Wt(n){return{c:y,m:y,p:y,i:y,o:y,d:y}}function Xt(n){let e,t,s,i,o,r;e=new Yt({props:{puzzle:n[6],game:n[0]}});const a=[Kt,Qt],l=[];function c(h,f){return h[0].guessing?0:1}return s=c(n),i=l[s]=a[s](n),{c(){K(e.$$.fragment),t=A(),i.c(),o=st()},m(h,f){$(e,h,f),T(h,t,f),l[s].m(h,f),T(h,o,f),r=!0},p(h,f){const u={};f&2&&(u.puzzle=h[6]),f&1&&(u.game=h[0]),e.$set(u);let d=s;s=c(h),s===d?l[s].p(h,f):(me(),F(l[d],1,1,()=>{l[d]=null}),ve(),i=l[s],i?i.p(h,f):(i=l[s]=a[s](h),i.c()),x(i,1),i.m(o.parentNode,o))},i(h){r||(x(e.$$.fragment,h),x(i),r=!0)},o(h){F(e.$$.fragment,h),F(i),r=!1},d(h){H(e,h),h&&I(t),l[s].d(h),h&&I(o)}}}function Qt(n){let e,t,s;function i(r){n[4](r)}let o={puzzle:n[6]};return n[0]!==void 0&&(o.game=n[0]),e=new Rt({props:o}),ce.push(()=>qe(e,"game",i)),{c(){K(e.$$.fragment)},m(r,a){$(e,r,a),s=!0},p(r,a){const l={};a&2&&(l.puzzle=r[6]),!t&&a&1&&(t=!0,l.game=r[0],ye(()=>t=!1)),e.$set(l)},i(r){s||(x(e.$$.fragment,r),s=!0)},o(r){F(e.$$.fragment,r),s=!1},d(r){H(e,r)}}}function Kt(n){let e,t,s,i,o;e=new qt({props:{pieces:n[6].pieces}});function r(l){n[3](l)}let a={puzzle:n[6]};return n[0]!==void 0&&(a.game=n[0]),s=new Tt({props:a}),ce.push(()=>qe(s,"game",r)),{c(){K(e.$$.fragment),t=A(),K(s.$$.fragment)},m(l,c){$(e,l,c),T(l,t,c),$(s,l,c),o=!0},p(l,c){const h={};c&2&&(h.pieces=l[6].pieces),e.$set(h);const f={};c&2&&(f.puzzle=l[6]),!i&&c&1&&(i=!0,f.game=l[0],ye(()=>i=!1)),s.$set(f)},i(l){o||(x(e.$$.fragment,l),x(s.$$.fragment,l),o=!0)},o(l){F(e.$$.fragment,l),F(s.$$.fragment,l),o=!1},d(l){H(e,l),l&&I(t),H(s,l)}}}function Jt(n){return{c:y,m:y,p:y,i:y,o:y,d:y}}function Zt(n){let e,t,s,i={ctx:n,current:null,token:null,hasCatch:!1,pending:Jt,then:Xt,catch:Wt,value:6,blocks:[,,,]};return Ie(t=n[1],i),{c(){e=g("div"),i.block.c(),_(e,"id","game")},m(o,r){T(o,e,r),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,s=!0},p(o,[r]){n=o,i.ctx=n,r&2&&t!==(t=n[1])&&Ie(t,i)||lt(i,n,r)},i(o){s||(x(i.block),s=!0)},o(o){for(let r=0;r<3;r+=1){const a=i.blocks[r];F(a)}s=!1},d(o){o&&I(e),i.block.d(),i.token=null,i=null}}}function es(n,e,t){let s=1;const i=async()=>{const c=await fetch("91.86.54.33:5000"),h=await c.json();if(c.ok)return console.log(h),h;throw new Error(h)};let o=i(),r={failedMove:void 0,guessing:!0,level:s,lives:3,fails:0};function a(c){r=c,t(0,r)}function l(c){r=c,t(0,r)}return n.$$.update=()=>{n.$$.dirty&5&&s<r.level&&(t(2,s=r.level),t(1,o=i()))},[r,o,s,a,l]}class ts extends ee{constructor(e){super(),Z(this,e,es,Zt,J,{})}}function ss(n){let e,t;return e=new ts({}),{c(){K(e.$$.fragment)},m(s,i){$(e,s,i),t=!0},p:y,i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){F(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}class is extends ee{constructor(e){super(),Z(this,e,null,ss,J,{})}}new is({target:document.getElementById("app")});

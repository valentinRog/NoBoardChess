(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function S(){}function at(n){return n&&typeof n=="object"&&typeof n.then=="function"}function et(n){return n()}function Me(){return Object.create(null)}function he(n){n.forEach(et)}function tt(n){return typeof n=="function"}function te(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let me;function J(n,e){return me||(me=document.createElement("a")),me.href=e,n===me.href}function lt(n){return Object.keys(n).length===0}function st(n){return n==null?"":n}function v(n,e){n.appendChild(e)}function x(n,e,t){n.insertBefore(e,t||null)}function C(n){n.parentNode.removeChild(n)}function W(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function _(n){return document.createElement(n)}function N(n){return document.createTextNode(n)}function L(){return N(" ")}function it(){return N("")}function $(n,e,t,s){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t,s)}function g(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function ct(n){return Array.from(n.childNodes)}function ae(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function re(n,e,t){n.classList[t?"add":"remove"](e)}let pe;function Y(n){pe=n}function nt(){if(!pe)throw new Error("Function called outside component initialization");return pe}function ht(n){nt().$$.on_mount.push(n)}const de=[],ce=[],be=[],Ee=[],ut=Promise.resolve();let Ie=!1;function dt(){Ie||(Ie=!0,ut.then(xe))}function Ce(n){be.push(n)}function ke(n){Ee.push(n)}const qe=new Set;let ge=0;function xe(){const n=pe;do{for(;ge<de.length;){const e=de[ge];ge++,Y(e),ft(e.$$)}for(Y(null),de.length=0,ge=0;ce.length;)ce.pop()();for(let e=0;e<be.length;e+=1){const t=be[e];qe.has(t)||(qe.add(t),t())}be.length=0}while(de.length);for(;Ee.length;)Ee.pop()();Ie=!1,qe.clear(),Y(n)}function ft(n){if(n.fragment!==null){n.update(),he(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Ce)}}const _e=new Set;let Z;function we(){Z={r:0,c:[],p:Z}}function ye(){Z.r||he(Z.c),Z=Z.p}function z(n,e){n&&n.i&&(_e.delete(n),n.i(e))}function F(n,e,t,s){if(n&&n.o){if(_e.has(n))return;_e.add(n),Z.c.push(()=>{_e.delete(n),s&&(t&&n.d(1),s())}),n.o(e)}else s&&s()}function Le(n,e){const t=e.token={};function s(i,r,o,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;o!==void 0&&(l=l.slice(),l[o]=a);const c=i&&(e.current=i)(l);let d=!1;e.block&&(e.blocks?e.blocks.forEach((f,u)=>{u!==r&&f&&(we(),F(f,1,1,()=>{e.blocks[u]===f&&(e.blocks[u]=null)}),ye())}):e.block.d(1),c.c(),z(c,1),c.m(e.mount(),e.anchor),d=!0),e.block=c,e.blocks&&(e.blocks[r]=c),d&&xe()}if(at(n)){const i=nt();if(n.then(r=>{Y(i),s(e.then,1,e.value,r),Y(null)},r=>{if(Y(i),s(e.catch,2,e.error,r),Y(null),!e.hasCatch)throw r}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,n),!0;e.resolved=n}}function pt(n,e,t){const s=e.slice(),{resolved:i}=n;n.current===n.then&&(s[n.value]=i),n.current===n.catch&&(s[n.error]=i),n.block.p(s,t)}function Se(n,e,t){const s=n.$$.props[e];s!==void 0&&(n.$$.bound[s]=t,t(n.$$.ctx[s]))}function ee(n){n&&n.c()}function X(n,e,t,s){const{fragment:i,on_mount:r,on_destroy:o,after_update:a}=n.$$;i&&i.m(e,t),s||Ce(()=>{const l=r.map(et).filter(tt);o?o.push(...l):he(l),n.$$.on_mount=[]}),a.forEach(Ce)}function Q(n,e){const t=n.$$;t.fragment!==null&&(he(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function mt(n,e){n.$$.dirty[0]===-1&&(de.push(n),dt(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function se(n,e,t,s,i,r,o,a=[-1]){const l=pe;Y(n);const c=n.$$={fragment:null,ctx:null,props:r,update:S,not_equal:i,bound:Me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Me(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let d=!1;if(c.ctx=t?t(n,e.props||{},(f,u,...h)=>{const k=h.length?h[0]:u;return c.ctx&&i(c.ctx[f],c.ctx[f]=k)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](k),d&&mt(n,f)),u}):[],c.update(),d=!0,he(c.before_update),c.fragment=s?s(c.ctx):!1,e.target){if(e.hydrate){const f=ct(e.target);c.fragment&&c.fragment.l(f),f.forEach(C)}else c.fragment&&c.fragment.c();e.intro&&z(n.$$.fragment),X(n,e.target,e.anchor,e.customElement),xe()}Y(l)}class ie{$destroy(){Q(this,1),this.$destroy=S}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!lt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const gt="/noboardchess/assets/bB.4ad35327.svg",vt="/noboardchess/assets/bK.470b3ff1.svg",bt="/noboardchess/assets/bN.147a1c46.svg",_t="/noboardchess/assets/bP.02f7ecfe.svg",kt="/noboardchess/assets/bQ.cc8f0224.svg",wt="/noboardchess/assets/bR.f9b05d72.svg",yt="/noboardchess/assets/wB.ea0a664a.svg",St="/noboardchess/assets/wK.fe4a8d94.svg",qt="/noboardchess/assets/wN.e0c94b20.svg",Pt="/noboardchess/assets/wP.93fed888.svg",Et="/noboardchess/assets/wQ.461e7e3d.svg",It="/noboardchess/assets/wR.afb9d215.svg";function ze(n,e,t){const s=n.slice();return s[3]=e[t],s}function Ae(n,e,t){const s=n.slice();return s[6]=e[t],s}function Oe(n,e,t){const s=n.slice();return s[9]=e[t],s}function Fe(n){let e,t=n[9]+"",s;return{c(){e=_("li"),s=N(t),g(e,"class","svelte-1rbu1ex")},m(i,r){x(i,e,r),v(e,s)},p:S,d(i){i&&C(e)}}}function De(n){let e,t,s,i,r,o=n[3].pieces[n[6]],a=[];for(let l=0;l<o.length;l+=1)a[l]=Fe(Oe(n,o,l));return{c(){e=_("div"),t=_("img"),i=L(),r=_("ul");for(let l=0;l<a.length;l+=1)a[l].c();J(t.src,s=n[0][n[6]])||g(t,"src",s),g(t,"alt",n[6]),g(t,"class","svelte-1rbu1ex"),g(r,"class","svelte-1rbu1ex"),g(e,"class",st(n[6])+" svelte-1rbu1ex")},m(l,c){x(l,e,c),v(e,t),v(e,i),v(e,r);for(let d=0;d<a.length;d+=1)a[d].m(r,null)},p(l,c){if(c&2){o=l[3].pieces[l[6]];let d;for(d=0;d<o.length;d+=1){const f=Oe(l,o,d);a[d]?a[d].p(f,c):(a[d]=Fe(f),a[d].c(),a[d].m(r,null))}for(;d<a.length;d+=1)a[d].d(1);a.length=o.length}},d(l){l&&C(e),W(a,l)}}}function Ne(n){let e,t,s=Object.keys(n[3].pieces),i=[];for(let r=0;r<s.length;r+=1)i[r]=De(Ae(n,s,r));return{c(){e=_("div");for(let r=0;r<i.length;r+=1)i[r].c();t=L(),g(e,"class",n[3].color+" container svelte-1rbu1ex")},m(r,o){x(r,e,o);for(let a=0;a<i.length;a+=1)i[a].m(e,null);v(e,t)},p(r,o){if(o&3){s=Object.keys(r[3].pieces);let a;for(a=0;a<s.length;a+=1){const l=Ae(r,s,a);i[a]?i[a].p(l,o):(i[a]=De(l),i[a].c(),i[a].m(e,t))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(r){r&&C(e),W(i,r)}}}function Ct(n){let e,t=n[1],s=[];for(let i=0;i<t.length;i+=1)s[i]=Ne(ze(n,t,i));return{c(){e=_("div");for(let i=0;i<s.length;i+=1)s[i].c();g(e,"id","pieces"),g(e,"class","svelte-1rbu1ex")},m(i,r){x(i,e,r);for(let o=0;o<s.length;o+=1)s[o].m(e,null)},p(i,[r]){if(r&3){t=i[1];let o;for(o=0;o<t.length;o+=1){const a=ze(i,t,o);s[o]?s[o].p(a,r):(s[o]=Ne(a),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=t.length}},i:S,o:S,d(i){i&&C(e),W(s,i)}}}function xt(n,e,t){let{pieces:s}=e;const i={b:gt,k:vt,n:bt,p:_t,q:kt,r:wt,B:yt,K:St,N:qt,P:Pt,Q:Et,R:It};let r=[{color:"white",pieces:Object.fromEntries(Object.entries(s).filter(([o,a])=>o===o.toUpperCase()))},{color:"black",pieces:Object.fromEntries(Object.entries(s).filter(([o,a])=>o===o.toLowerCase()))}];return n.$$set=o=>{"pieces"in o&&t(2,s=o.pieces)},[i,r,s]}class Tt extends ie{constructor(e){super(),se(this,e,xt,Ct,te,{pieces:2})}}function Mt(n){let e,t,s,i;return{c(){e=_("div"),t=N(n[3]),g(e,"class",st(n[4])+" svelte-yw0l3s"),re(e,"active",n[0]===n[1]+1),re(e,"failed",n[2]),re(e,"pointer",n[0]!==null)},m(r,o){x(r,e,o),v(e,t),s||(i=$(e,"click",n[6]),s=!0)},p(r,[o]){o&8&&ae(t,r[3]),o&3&&re(e,"active",r[0]===r[1]+1),o&4&&re(e,"failed",r[2]),o&1&&re(e,"pointer",r[0]!==null)},i:S,o:S,d(r){r&&C(e),s=!1,i()}}}function Lt(n,e,t){let{puzzle:s}=e,{moveIndex:i}=e,{activeFenIndex:r=null}=e,{failed:o=!1}=e,a="";const l=s.fens[i].split(" ")[1],c=u=>Number(u.split(" ").at(-1)),d=1+c(s.fens[i+1])-c(s.fens[1]);a+=String(d)+(l==="w"?".":"..."),a+=s.san_moves[i];const f=()=>{r!==null&&t(0,r=i+1)};return n.$$set=u=>{"puzzle"in u&&t(5,s=u.puzzle),"moveIndex"in u&&t(1,i=u.moveIndex),"activeFenIndex"in u&&t(0,r=u.activeFenIndex),"failed"in u&&t(2,o=u.failed)},[r,i,o,a,l,s,f]}class rt extends ie{constructor(e){super(),se(this,e,Lt,Mt,te,{puzzle:5,moveIndex:1,activeFenIndex:0,failed:2})}}function Ge(n,e,t){const s=n.slice();return s[9]=e[t],s}function Be(n,e,t){const s=n.slice();return s[12]=e[t],s[14]=t,s}function Ue(n){let e,t,s,i;return t=new rt({props:{puzzle:n[0],moveIndex:n[14]}}),{c(){e=_("div"),ee(t.$$.fragment),s=L(),g(e,"class","svelte-3op8wm")},m(r,o){x(r,e,o),X(t,e,null),v(e,s),i=!0},p(r,o){const a={};o&1&&(a.puzzle=r[0]),t.$set(a)},i(r){i||(z(t.$$.fragment,r),i=!0)},o(r){F(t.$$.fragment,r),i=!1},d(r){r&&C(e),Q(t)}}}function Re(n){let e,t=n[9]+"",s,i,r;return{c(){e=_("button"),s=N(t)},m(o,a){x(o,e,a),v(e,s),i||(r=$(e,"click",function(){tt(n[4](n[9]))&&n[4](n[9]).apply(this,arguments)}),i=!0)},p(o,a){n=o,a&4&&t!==(t=n[9]+"")&&ae(s,t)},d(o){o&&C(e),i=!1,r()}}}function zt(n){let e,t,s,i,r,o,a,l=n[3],c=[];for(let h=0;h<l.length;h+=1)c[h]=Ue(Be(n,l,h));const d=h=>F(c[h],1,1,()=>{c[h]=null});let f=n[2],u=[];for(let h=0;h<f.length;h+=1)u[h]=Re(Ge(n,f,h));return{c(){e=_("div"),t=_("div");for(let h=0;h<c.length;h+=1)c[h].c();s=L(),i=_("div"),r=N(n[1]),o=L();for(let h=0;h<u.length;h+=1)u[h].c();g(t,"id","line"),g(t,"class","svelte-3op8wm")},m(h,k){x(h,e,k),v(e,t);for(let m=0;m<c.length;m+=1)c[m].m(t,null);v(e,s),v(e,i),v(i,r),v(e,o);for(let m=0;m<u.length;m+=1)u[m].m(e,null);a=!0},p(h,[k]){if(k&9){l=h[3];let m;for(m=0;m<l.length;m+=1){const O=Be(h,l,m);c[m]?(c[m].p(O,k),z(c[m],1)):(c[m]=Ue(O),c[m].c(),z(c[m],1),c[m].m(t,null))}for(we(),m=l.length;m<c.length;m+=1)d(m);ye()}if((!a||k&2)&&ae(r,h[1]),k&20){f=h[2];let m;for(m=0;m<f.length;m+=1){const O=Ge(h,f,m);u[m]?u[m].p(O,k):(u[m]=Re(O),u[m].c(),u[m].m(e,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=f.length}},i(h){if(!a){for(let k=0;k<l.length;k+=1)z(c[k]);a=!0}},o(h){c=c.filter(Boolean);for(let k=0;k<c.length;k+=1)F(c[k]);a=!1},d(h){h&&C(e),W(c,h),W(u,h)}}}function At(n,e,t){let s,i,{puzzle:r}=e,{game:o}=e;o.failedMoveIndex=null;let a=1,l="";const c=()=>{let u=[];return a<r.legal_san_moves.length&&l!==s&&(r.legal_san_moves[a].forEach(h=>{h.startsWith(l)&&!u.includes(h[l.length])&&(u=[...u,h[l.length]])}),u=u.sort()),u};let d=c();const f=u=>()=>{if(u===s[l.length]){for(t(1,l+=u);c().length===1;)t(1,l+=c()[0]);l===s&&(t(6,a+=2),t(1,l=""),a>r.san_moves.length-1&&t(5,o.guessing=!1,o)),t(2,d=c())}else t(5,o.failedMoveIndex=a,o),t(5,o.fails++,o),t(5,o.guessing=!1,o)};return n.$$set=u=>{"puzzle"in u&&t(0,r=u.puzzle),"game"in u&&t(5,o=u.game)},n.$$.update=()=>{n.$$.dirty&65&&(s=r.san_moves[a]),n.$$.dirty&65&&t(3,i=r.san_moves.slice(0,a))},[r,l,d,i,f,o,a]}class Ot extends ie{constructor(e){super(),se(this,e,At,zt,te,{puzzle:0,game:5})}}const Ft="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Dt="8/8/8/8/8/8/8/8",fe={start:Ft,empty:Dt};class I{constructor(e=void 0){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=fe.empty){let t;e==="start"?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty"),t=fe.start):e==="empty"||e===void 0?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty"),t=fe.empty):t=e;const s=t.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let i=0;i<8;i++){const r=s[7-i].replace(/\d/g,o=>{const a=parseInt(o);let l="";for(let c=0;c<a;c++)l+="-";return l});for(let o=0;o<8;o++){const a=r.substring(o,o+1);let l=null;a!=="-"&&(a.toUpperCase()===a?l=`w${a.toLowerCase()}`:l=`b${a}`),this.squares[i*8+o]=l}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){const r=this.squares[t*8+i];if(!r)s++;else{s>0&&(e[7-t]+=s,s=0);const o=r.substring(0,1),a=r.substring(1,2);o==="w"?e[7-t]+=a.toUpperCase():e[7-t]+=a}}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(e=["k","q","r","b","n","p"]){const t=[],s=(i,r)=>e.indexOf(i.name)-e.indexOf(r.name);for(let i=0;i<64;i++){const r=this.squares[i];r&&t.push({name:r.charAt(1),color:r.charAt(0),position:I.indexToSquare(i)})}return e&&t.sort(s),t}movePiece(e,t){if(!this.squares[I.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[I.squareToIndex(t)]=this.squares[I.squareToIndex(e)],this.squares[I.squareToIndex(e)]=void 0}setPiece(e,t){this.squares[I.squareToIndex(e)]=t}getPiece(e){return this.squares[I.squareToIndex(e)]}static squareToIndex(e){const t=e.substring(0,1).charCodeAt(0)-97,s=e.substring(1,2)-1;return 8*s+t}static indexToSquare(e){const t=String.fromCharCode(e%8+97),s=Math.floor(e/8)+1;return t+s}clone(){const e=new I;return e.squares=this.squares.slice(0),e}}function ot(){let n,e;const t=new Promise(function(s,i){n=s,e=i});return t.resolve=n,t.reject=e,t}class Nt{constructor(){this.position=new I,this.orientation=void 0,this.markers=[],this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.inputEnabled=!1,this.squareSelectEnabled=!1,this.extensionPoints={},this.moveInputProcess=ot().resolve()}setPosition(e,t=!1){this.position=new I(e,t)}movePiece(e,t,s=!1){const i=this._position.clone();i.animated=s;const r=i.getPiece(e);r||console.error("no piece on",e),i.setPiece(e,void 0),i.setPiece(t,r),this._position=i}setPiece(e,t,s=!1){const i=this._position.clone();i.animated=s,i.setPiece(e,t),this._position=i}addMarker(e,t){this.markers.push({square:e,type:t})}removeMarkers(e=void 0,t=void 0){!e&&!t?this.markers=[]:this.markers=this.markers.filter(s=>{if(t){if(e){if(s.type===t&&e===s.square)return!1}else if(s.type===t)return!1}else if(e===s.square)return!1;return!0})}invokeExtensionPoints(e,t={}){const s=this.extensionPoints[e],i=Object.assign({},t);if(i.extensionPoint=e,s)for(const r of s)setTimeout(()=>{r(i)})}}const p={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},ve={secondClick:"secondClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},He=4;class Gt{constructor(e,t,s,i){this.view=e,this.chessboard=e.chessboard,this.moveInputStartedCallback=r=>{const o=t(r);return o&&(this.chessboard.state.moveInputProcess=ot()),o},this.validateMoveInputCallback=(r,o)=>{const a=s(r,o);return this.chessboard.state.moveInputProcess.resolve(a),a},this.moveInputCanceledCallback=(r,o,a)=>{i(r,o,a),this.chessboard.state.moveInputProcess.resolve()},this.setMoveInputState(p.waitForInputStart)}setMoveInputState(e,t=void 0){const s=this.moveInputState;switch(this.moveInputState=e,e){case p.waitForInputStart:break;case p.pieceClickedThreshold:if(p.waitForInputStart!==s&&p.clickTo!==s)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.fromSquare=t.square,this.toSquare=void 0,this.movedPiece=t.piece,this.updateStartEndMarkers(),this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener)if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("event type");else throw Error("_pointerMoveListener or _pointerUpListener");break;case p.clickTo:this.draggablePiece&&(P.removeElement(this.draggablePiece),this.draggablePiece=void 0),s===p.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case p.secondClickThreshold:if(p.clickTo!==s)throw new Error("moveInputState");this.startPoint=t.point;break;case p.dragTo:if(p.pieceClickedThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case p.clickDragTo:if(p.secondClickThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case p.moveDone:if([p.dragTo,p.clickTo,p.clickDragTo].indexOf(s)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?s===p.clickTo?this.chessboard.movePiece(this.fromSquare,this.toSquare,!0).then(()=>{this.setMoveInputState(p.reset)}):this.chessboard.movePiece(this.fromSquare,this.toSquare,!1).then(()=>{this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(p.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(p.reset));break;case p.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=void 0,this.toSquare=void 0,this.movedPiece=void 0,this.updateStartEndMarkers(),this.draggablePiece&&(P.removeElement(this.draggablePiece),this.draggablePiece=void 0),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.setMoveInputState(p.waitForInputStart);break;default:throw Error(`moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece exists");this.draggablePiece=P.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,s=P.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),i=this.view.squareHeight/this.chessboard.props.sprite.size,r=this.draggablePiece.createSVGTransform();r.setScale(i,i),s.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(e.type==="mousedown"&&e.button===0||e.type==="touchstart"){const t=e.target.getAttribute("data-square");if(t){const s=this.chessboard.getPiece(t);let i;if(s&&(i=s?s.substring(0,1):void 0,(i==="w"&&this.chessboard.state.inputWhiteEnabled||i==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==p.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&i==="w"||this.chessboard.state.inputBlackEnabled&&i==="b"){let r;if(e.type==="mousedown"?r={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===p.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(p.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type});else if(this.moveInputState===p.clickTo)if(t===this.fromSquare)this.setMoveInputState(p.secondClickThreshold,{square:t,piece:s,point:r,type:e.type});else{const o=this.chessboard.getPiece(t),a=o?o.substring(0,1):void 0,l=this.chessboard.getPiece(this.fromSquare),c=l?l.substring(0,1):void 0;i&&c===a?(this.moveInputCanceledCallback(ve.clickedAnotherPiece,this.fromSquare,t),this.moveInputStartedCallback(t)?this.setMoveInputState(p.pieceClickedThreshold,{square:t,piece:o,point:r,type:e.type}):this.setMoveInputState(p.reset)):this.setMoveInputState(p.moveDone,{square:t})}}}}}onPointerMove(e){let t,s,i,r,o;if(e.type==="mousemove"?(i=e.clientX,r=e.clientY,t=e.pageX,s=e.pageY,o=e.target):e.type==="touchmove"&&(i=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,o=document.elementFromPoint(i,r)),this.moveInputState===p.pieceClickedThreshold||this.moveInputState===p.secondClickThreshold)(Math.abs(this.startPoint.x-i)>He||Math.abs(this.startPoint.y-r)>He)&&(this.moveInputState===p.secondClickThreshold?this.setMoveInputState(p.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(p.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled&&this.moveDraggablePiece(t,s));else if(this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo||this.moveInputState===p.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const a=o.getAttribute("data-square");a!==this.fromSquare&&a!==this.toSquare?(this.toSquare=a,this.updateStartEndMarkers()):a===this.fromSquare&&this.toSquare!==void 0&&(this.toSquare=void 0,this.updateStartEndMarkers())}else this.toSquare!==void 0&&(this.toSquare=void 0,this.updateStartEndMarkers());this.view.chessboard.state.inputEnabled&&(this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo)&&this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const s=t.getAttribute("data-square");if(s)this.moveInputState===p.dragTo||this.moveInputState===p.clickDragTo?this.fromSquare===s?this.moveInputState===p.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(ve.draggedBack,s,s),this.setMoveInputState(p.reset)):this.setMoveInputState(p.clickTo,{square:s}):this.setMoveInputState(p.moveDone,{square:s}):this.moveInputState===p.pieceClickedThreshold?this.setMoveInputState(p.clickTo,{square:s}):this.moveInputState===p.secondClickThreshold&&(this.setMoveInputState(p.reset),this.moveInputCanceledCallback(ve.secondClick,s,s));else{this.view.redrawPieces();const i=this.fromSquare;this.setMoveInputState(p.reset),this.moveInputCanceledCallback(ve.movedOutOfBoard,i,void 0)}}else this.view.redrawPieces(),this.setMoveInputState(p.reset)}updateStartEndMarkers(){this.chessboard.props.style.moveFromMarker&&this.chessboard.state.removeMarkers(void 0,this.chessboard.props.style.moveFromMarker),this.chessboard.props.style.moveToMarker&&this.chessboard.state.removeMarkers(void 0,this.chessboard.props.style.moveToMarker),this.chessboard.props.style.moveFromMarker&&this.fromSquare&&this.chessboard.state.addMarker(this.fromSquare,this.chessboard.props.style.moveFromMarker),this.chessboard.props.style.moveToMarker&&this.toSquare&&this.chessboard.state.addMarker(this.toSquare,this.chessboard.props.style.moveToMarker),this.view.drawMarkers()}reset(){this.setMoveInputState(p.reset)}destroy(){this.reset()}}const G={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",moveInputStateChanged:"moveInput",destroy:"destroy",redrawBoard:"redrawBoard"};class Bt{constructor(e){this.chessboard=e,this.moveInput=new Gt(this,this.moveInputStartedCallback.bind(this),this.validateMoveInputCallback.bind(this),this.moveInputCanceledCallback.bind(this)),e.props.sprite.cache&&this.cacheSpriteToDiv("chessboardSpriteCache",this.chessboard.props.sprite.url),this.context=document.createElement("div"),this.chessboard.context.appendChild(this.context),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.pointerDownListener=this.pointerDownHandler.bind(this),this.pointerDownListener=this.pointerDownHandler.bind(this),this.context.addEventListener("mousedown",this.pointerDownListener),this.context.addEventListener("touchstart",this.pointerDownListener),this.createSvgAndGroups(),this.updateMetrics(),this.handleResize(),this.redrawBoard()}pointerDownHandler(e){this.moveInput.onPointerDown(e)}destroy(){this.moveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),this.animationQueue=[],this.currentAnimation&&cancelAnimationFrame(this.currentAnimation.frameHandle),P.removeElement(this.svg)}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const s=document.createElement("div");s.style.display="none",s.id=e,document.body.appendChild(s);const i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=P.createSvg(this.context);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=P.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=P.addElement(this.svg,"g",{class:"coordinates"}),this.markersLayer=P.addElement(this.svg,"g",{class:"markers-layer"}),this.markersGroup=P.addElement(this.markersLayer,"g",{class:"markers"}),this.piecesLayer=P.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=P.addElement(this.piecesLayer,"g",{class:"pieces"})}updateMetrics(){this.width=this.context.clientWidth,this.height=this.context.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===oe.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===oe.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/this.chessboard.props.sprite.size,this.scalingY=this.squareHeight/this.chessboard.props.sprite.size,this.pieceXTranslate=this.squareWidth/2-this.chessboard.props.sprite.size*this.scalingY/2}handleResize(){this.context.style.width=this.chessboard.context.clientWidth+"px",this.context.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.context.clientWidth!==this.width||this.context.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.redrawSquares(),this.drawCoordinates(),this.drawMarkers(),this.chessboard.state.invokeExtensionPoints(G.redrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(P.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===oe.frame){const t=this.borderSize;P.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const s=this.chessboard.state.orientation===j.white?t:63-t,r=`square ${(9*s&8)===0?"black":"white"}`,o=this.squareToPoint(I.indexToSquare(s)),a=P.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});a.setAttribute("class",r),a.setAttribute("data-square",I.indexToSquare(s))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==oe.frame;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.sprite.size*t)*this.scalingX,i=this.height-this.scalingY*3.5,r="coordinate file";e&&(s=s+this.scalingX*15.5,r+=t%2?" white":" black");const o=P.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===j.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===oe.frame?(s=s+this.scalingX*10,i=i-this.scalingY*15):(s=s+this.scalingX*2,i=i-this.scalingY*15));const o=P.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===j.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes);for(let s=0;s<64;s++){const i=e[s];i&&this.drawPiece(I.indexToSquare(s),i)}for(const s of t)this.piecesGroup.removeChild(s)}drawPiece(e,t){const s=P.addElement(this.piecesGroup,"g");s.setAttribute("data-piece",t),s.setAttribute("data-square",e);const i=this.squareToPoint(e),r=this.svg.createSVGTransform();r.setTranslate(i.x,i.y),s.transform.baseVal.appendItem(r);const o=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,a=P.addElement(s,"use",{href:`${o}#${t}`,class:"piece"}),l=this.svg.createSVGTransform();l.setTranslate(this.pieceXTranslate,0),a.transform.baseVal.appendItem(l);const c=this.svg.createSVGTransform();return c.setScale(this.scalingY,this.scalingY),a.transform.baseVal.appendItem(c),s}setPieceVisibility(e,t=!0){const s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(e.length<2)throw new Error("980e03");const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||console.warn("no piece on",e),t}drawMarkers(){for(;this.markersGroup.firstChild;)this.markersGroup.removeChild(this.markersGroup.firstChild);this.chessboard.state.markers.forEach(e=>{this.drawMarker(e)})}drawMarker(e){const t=P.addElement(this.markersGroup,"g");t.setAttribute("data-square",e.square);const s=this.squareToPoint(e.square),i=this.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);const r=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,o=P.addElement(t,"use",{href:`${r}#${e.type.slice}`,class:"marker "+e.type.class}),a=this.svg.createSVGTransform();return a.setScale(this.scalingX,this.scalingY),o.transform.baseVal.appendItem(a),t}enableMoveInput(e,t=void 0){t===j.white?this.chessboard.state.inputWhiteEnabled=!0:t===j.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.inputEnabled=!0,this.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(G.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.inputEnabled=!1,this.moveInputCallback=void 0,this.chessboard.state.invokeExtensionPoints(G.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:Pe.moveInputStarted,square:e};return this.chessboard.state.invokeExtensionPoints(G.moveInput,t),this.moveInputCallback?this.moveInputCallback(t):!0}validateMoveInputCallback(e,t){const s={chessboard:this.chessboard,type:Pe.validateMoveInput,squareFrom:e,squareTo:t};return this.chessboard.state.invokeExtensionPoints(G.moveInput,s),this.moveInputCallback?this.moveInputCallback(s):!0}moveInputCanceledCallback(e,t,s){const i={chessboard:this.chessboard,type:Pe.moveInputCanceled,reason:e,squareFrom:t,squareTo:s};this.chessboard.state.invokeExtensionPoints(G.moveInput,i),this.moveInputCallback&&this.moveInputCallback(i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled||this.chessboard.state.squareSelectEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===j.white?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){const t=I.squareToIndex(e);return this.indexToPoint(t)}}const Ve="http://www.w3.org/2000/svg";class P{static createSvg(e=void 0){let t=document.createElementNS(Ve,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s,i=void 0){let r=document.createElementNS(Ve,t);t==="use"&&(s["xlink:href"]=s.href);for(let o in s)if(s.hasOwnProperty(o))if(o.indexOf(":")!==-1){const a=o.split(":");r.setAttributeNS("http://www.w3.org/1999/"+a[0],a[1],s[o])}else r.setAttribute(o,s[o]);return i!==void 0?e.appendChild(r):e.insertBefore(r,i),r}static removeElement(e){e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}class Ut{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(!!e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const R={move:0,appear:1,disappear:2};class le{constructor(e,t,s,i,r){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=r,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s)}static seekChanges(e,t){const s=[],i=[],r=[];for(let o=0;o<64;o++){const a=e[o],l=t[o];l!==a&&(l&&s.push({piece:l,index:o}),a&&i.push({piece:a,index:o}))}return s.forEach(o=>{let a=8,l;i.forEach(c=>{if(o.piece===c.piece){const d=le.squareDistance(o.index,c.index);d<a&&(l=c,a=d)}}),l?(i.splice(i.indexOf(l),1),r.push({type:R.move,piece:o.piece,atIndex:l.index,toIndex:o.index})):r.push({type:R.appear,piece:o.piece,atIndex:o.index})}),i.forEach(o=>{r.push({type:R.disappear,piece:o.piece,atIndex:o.index})}),r}createAnimation(e,t){const s=le.seekChanges(e,t),i=[];return s.forEach(r=>{const o={type:r.type};switch(r.type){case R.move:o.element=this.view.getPieceElement(I.indexToSquare(r.atIndex)),o.element.parentNode.appendChild(o.element),o.atPoint=this.view.indexToPoint(r.atIndex),o.toPoint=this.view.indexToPoint(r.toIndex);break;case R.appear:o.element=this.view.drawPiece(I.indexToSquare(r.atIndex),r.piece),o.element.style.opacity=0;break;case R.disappear:o.element=this.view.getPieceElement(I.indexToSquare(r.atIndex));break}i.push(o)}),i}animationStep(e){this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(r=>{r.type===R.disappear&&P.removeElement(r.element)}),this.callback();return}const s=Math.min(1,t/this.duration);let i=s<.5?2*s*s:-1+(4-2*s)*s;isNaN(i)&&(i=1),this.animatedElements.forEach(r=>{if(r.element)switch(r.type){case R.move:r.element.transform.baseVal.removeItem(0);const o=this.view.svg.createSVGTransform();o.setTranslate(r.atPoint.x+(r.toPoint.x-r.atPoint.x)*i,r.atPoint.y+(r.toPoint.y-r.atPoint.y)*i),r.element.transform.baseVal.appendItem(o);break;case R.appear:r.element.style.opacity=Math.round(i*100)/100;break;case R.disappear:r.element.style.opacity=Math.round((1-i)*100)/100;break}else console.warn("animatedItem has no element",r)})}static squareDistance(e,t){const s=e%8,i=Math.floor(e/8),r=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-i),Math.abs(r-s))}}class Rt extends Ut{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(i=>{let r=s?this.chessboard.props.animationDuration:0;this.queue.length>0&&(r=r/(1+Math.pow(this.queue.length/5,2))),new le(this.chessboard.view,e,t,s?r:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()})}))}async enqueueTurnBoard(e,t,s){return super.enqueue(()=>new Promise(i=>{const r=new I(fe.empty);let o=s?this.chessboard.props.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new le(this.chessboard.view,e,r,s?o:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(r.squares),new le(this.chessboard.view,r,e,s?o:0,()=>{this.chessboard.view.redrawPieces(e.squares),i()})})}))}}const j={white:"w",black:"b"},Pe={moveStart:"moveInputStarted",moveInputStarted:"moveInputStarted",moveDone:"validateMoveInput",validateMoveInput:"validateMoveInput",moveCanceled:"moveInputCanceled",moveInputCanceled:"moveInputCanceled"},je={primary:"primary",secondary:"secondary"},oe={none:"none",thin:"thin",frame:"frame"},Ye={frame:{class:"marker-frame",slice:"markerFrame"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot"},circle:{class:"marker-circle",slice:"markerCircle"}};class Ht{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[];let s={position:fe.empty,orientation:j.white,responsive:!0,animationDuration:300,language:navigator.language.substring(0,2).toLowerCase(),style:{cssClass:"default",showCoordinates:!0,borderType:oe.none,aspectRatio:1,moveFromMarker:Ye.frame,moveToMarker:Ye.frame},sprite:{url:"./assets/images/chessboard-sprite.svg",size:40,cache:!0},extensions:[]};this.props={},Object.assign(this.props,s),Object.assign(this.props,t),this.props.sprite=s.sprite,this.props.style=s.style,t.sprite&&Object.assign(this.props.sprite,t.sprite),t.style&&Object.assign(this.props.style,t.style),t.extensions&&(this.props.extensions=t.extensions),this.props.language!=="de"&&this.props.language!=="en"&&(this.props.language="en"),this.state=new Nt,this.view=new Bt(this),this.positionAnimationsQueue=new Rt(this),this.state.orientation=this.props.orientation;for(const i of this.props.extensions)this.extensions.push(new i.class(this,i.props));this.view.redrawBoard(),this.state.position=new I(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(G.positionChanged)}async setPiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(G.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(G.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e,t=!1){const s=this.state.position.clone(),i=new I(e);return s.getFen()!==i.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(G.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e,t=!1){const s=this.state.position.clone();if(this.boardTurning){console.log("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(G.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.state.addMarker(t,e),this.view.drawMarkers()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}const s=[];return this.state.markers.forEach(i=>{const r=i.square;(!t&&(!e||e===i.type)||!e&&t===r||e===i.type&&t===r)&&s.push({square:i.square,type:i.type})}),s}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.state.removeMarkers(t,e),this.view.drawMarkers()}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}enableSquareSelect(e){if(this.squareSelectListener){console.warn("squareSelectListener already existing");return}this.squareSelectListener=function(t){const s=t.target.getAttribute("data-square");if(t.type==="contextmenu"){t.preventDefault();return}e({chessboard:this,type:t.button===2?je.secondary:je.primary,square:s})},this.context.addEventListener("contextmenu",this.squareSelectListener),this.context.addEventListener("mouseup",this.squareSelectListener),this.context.addEventListener("touchend",this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(){this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}destroy(){this.state.invokeExtensionPoints(G.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0,this.squareSelectListener&&(this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener))}}const Vt="/noboardchess/assets/chessboard-sprite-staunty.485981d8.svg";const jt="/noboardchess/assets/chevron_right.7ea5f89f.svg",Yt="/noboardchess/assets/chevron_left.5f0c5e3b.svg",$t="/noboardchess/assets/first_page.f5439e4d.svg",Wt="/noboardchess/assets/last_page.06c0e9ba.svg";function $e(n,e,t){const s=n.slice();return s[9]=e[t],s[11]=t,s}function We(n){let e,t,s,i,r;function o(l){n[8](l)}let a={puzzle:n[0],moveIndex:n[11],failed:n[11]===n[1].failedMoveIndex};return n[2]!==void 0&&(a.activeFenIndex=n[2]),t=new rt({props:a}),ce.push(()=>Se(t,"activeFenIndex",o)),{c(){e=_("div"),ee(t.$$.fragment),i=L(),g(e,"class","svelte-m0fraf")},m(l,c){x(l,e,c),X(t,e,null),v(e,i),r=!0},p(l,c){const d={};c&1&&(d.puzzle=l[0]),c&2&&(d.failed=l[11]===l[1].failedMoveIndex),!s&&c&4&&(s=!0,d.activeFenIndex=l[2],ke(()=>s=!1)),t.$set(d)},i(l){r||(z(t.$$.fragment,l),r=!0)},o(l){F(t.$$.fragment,l),r=!1},d(l){l&&C(e),Q(t)}}}function Xt(n){let e,t,s,i,r,o,a,l,c,d,f,u,h,k,m,O,ue,H,V,K,ne,U,E,B,M,A,b=n[0].san_moves,y=[];for(let q=0;q<b.length;q+=1)y[q]=We($e(n,b,q));const w=q=>F(y[q],1,1,()=>{y[q]=null});return{c(){e=_("div"),t=_("div"),s=_("div"),s.innerHTML='<div id="chessboard"></div>',i=L(),r=_("div"),o=_("button"),a=_("img"),c=L(),d=_("button"),f=_("img"),h=L(),k=_("button"),m=_("img"),ue=L(),H=_("button"),V=_("img"),ne=L(),U=_("div"),E=_("div");for(let q=0;q<y.length;q+=1)y[q].c();g(s,"class","container svelte-m0fraf"),J(a.src,l=$t)||g(a,"src",l),g(a,"alt","first"),g(a,"class","svelte-m0fraf"),J(f.src,u=Yt)||g(f,"src",u),g(f,"alt","prev"),g(f,"class","svelte-m0fraf"),J(m.src,O=jt)||g(m,"src",O),g(m,"alt","next"),g(m,"class","svelte-m0fraf"),J(V.src,K=Wt)||g(V,"src",K),g(V,"alt","last"),g(V,"class","svelte-m0fraf"),g(r,"id","controls"),g(r,"class","svelte-m0fraf"),g(t,"id","board"),g(t,"class","svelte-m0fraf"),g(E,"id","line"),g(E,"class","svelte-m0fraf"),g(e,"id","answer"),g(e,"class","svelte-m0fraf")},m(q,D){x(q,e,D),v(e,t),v(t,s),v(t,i),v(t,r),v(r,o),v(o,a),v(r,c),v(r,d),v(d,f),v(r,h),v(r,k),v(k,m),v(r,ue),v(r,H),v(H,V),v(e,ne),v(e,U),v(U,E);for(let T=0;T<y.length;T+=1)y[T].m(E,null);B=!0,M||(A=[$(o,"click",n[3]),$(d,"click",n[4]),$(k,"click",n[5]),$(H,"click",n[6])],M=!0)},p(q,[D]){if(D&7){b=q[0].san_moves;let T;for(T=0;T<b.length;T+=1){const Te=$e(q,b,T);y[T]?(y[T].p(Te,D),z(y[T],1)):(y[T]=We(Te),y[T].c(),z(y[T],1),y[T].m(E,null))}for(we(),T=b.length;T<y.length;T+=1)w(T);ye()}},i(q){if(!B){for(let D=0;D<b.length;D+=1)z(y[D]);B=!0}},o(q){y=y.filter(Boolean);for(let D=0;D<y.length;D+=1)F(y[D]);B=!1},d(q){q&&C(e),W(y,q),M=!1,he(A)}}}function Qt(n,e,t){let{puzzle:s}=e,{game:i}=e,r;ht(()=>{t(7,r=new Ht(document.getElementById("chessboard"),{position:s.fen,orientation:s.fen.split(" ")[1]==="b"?j.white:j.black,sprite:{url:Vt},style:{cssClass:"black-and-white"}}))});let o=0;const a=()=>{t(2,o=0)},l=()=>{o&&t(2,o--,o)},c=()=>{o<s.san_moves.length&&t(2,o++,o)},d=()=>{t(2,o=s.san_moves.length)};function f(u){o=u,t(2,o)}return n.$$set=u=>{"puzzle"in u&&t(0,s=u.puzzle),"game"in u&&t(1,i=u.game)},n.$$.update=()=>{n.$$.dirty&133&&r&&r.setPosition(s.fens[o],!0)},[s,i,o,a,l,c,d,r,f]}class Kt extends ie{constructor(e){super(),se(this,e,Qt,Xt,te,{puzzle:0,game:1})}}const Jt="/noboardchess/assets/heart.8da15a2b.svg",Zt="/noboardchess/assets/broken_heart.dc79b59f.svg";function Xe(n,e,t){const s=n.slice();return s[4]=e[t],s}function Qe(n,e,t){const s=n.slice();return s[4]=e[t],s}function Ke(n){let e,t;return{c(){e=_("img"),J(e.src,t=Jt)||g(e,"src",t),g(e,"alt","heart"),g(e,"class","heart svelte-1xhoy2m")},m(s,i){x(s,e,i)},p:S,d(s){s&&C(e)}}}function Je(n){let e,t;return{c(){e=_("img"),J(e.src,t=Zt)||g(e,"src",t),g(e,"alt","broken heart"),g(e,"class","broken-heart svelte-1xhoy2m")},m(s,i){x(s,e,i)},p:S,d(s){s&&C(e)}}}function Ze(n){let e;function t(r,o){return r[0].fails<r[0].lives?ts:es}let s=t(n),i=s(n);return{c(){i.c(),e=it()},m(r,o){i.m(r,o),x(r,e,o)},p(r,o){s===(s=t(r))&&i?i.p(r,o):(i.d(1),i=s(r),i&&(i.c(),i.m(e.parentNode,e)))},d(r){i.d(r),r&&C(e)}}}function es(n){let e,t,s;return{c(){e=_("button"),e.textContent="restart"},m(i,r){x(i,e,r),t||(s=$(e,"click",n[3]),t=!0)},p:S,d(i){i&&C(e),t=!1,s()}}}function ts(n){let e,t,s;return{c(){e=_("button"),e.textContent="next"},m(i,r){x(i,e,r),t||(s=$(e,"click",n[2]),t=!0)},p:S,d(i){i&&C(e),t=!1,s()}}}function ss(n){let e,t,s,i=n[0].level+"",r,o,a,l,c,d,f,u,h,k,m=n[1].elo+"",O,ue,H,V,K=n[1].n_pieces+"",ne,U=Array(n[0].lives-n[0].fails),E=[];for(let b=0;b<U.length;b+=1)E[b]=Ke(Qe(n,U,b));let B=Array(n[0].fails),M=[];for(let b=0;b<B.length;b+=1)M[b]=Je(Xe(n,B,b));let A=!n[0].guessing&&Ze(n);return{c(){e=_("div"),t=_("div"),s=N("#"),r=N(i),o=L(),a=_("div");for(let b=0;b<E.length;b+=1)E[b].c();l=L();for(let b=0;b<M.length;b+=1)M[b].c();c=L(),A&&A.c(),d=L(),f=_("div"),u=_("ul"),h=_("li"),k=N("Rating: "),O=N(m),ue=L(),H=_("li"),V=N("Number of pieces: "),ne=N(K),g(t,"id","level"),g(t,"class","svelte-1xhoy2m"),g(a,"id","lives"),g(a,"class","svelte-1xhoy2m"),g(u,"class","svelte-1xhoy2m"),g(f,"class","svelte-1xhoy2m"),g(e,"id","infos"),g(e,"class","svelte-1xhoy2m")},m(b,y){x(b,e,y),v(e,t),v(t,s),v(t,r),v(e,o),v(e,a);for(let w=0;w<E.length;w+=1)E[w].m(a,null);v(a,l);for(let w=0;w<M.length;w+=1)M[w].m(a,null);v(e,c),A&&A.m(e,null),v(e,d),v(e,f),v(f,u),v(u,h),v(h,k),v(h,O),v(u,ue),v(u,H),v(H,V),v(H,ne)},p(b,[y]){if(y&1&&i!==(i=b[0].level+"")&&ae(r,i),y&1){U=Array(b[0].lives-b[0].fails);let w;for(w=0;w<U.length;w+=1){const q=Qe(b,U,w);E[w]?E[w].p(q,y):(E[w]=Ke(),E[w].c(),E[w].m(a,l))}for(;w<E.length;w+=1)E[w].d(1);E.length=U.length}if(y&1){B=Array(b[0].fails);let w;for(w=0;w<B.length;w+=1){const q=Xe(b,B,w);M[w]?M[w].p(q,y):(M[w]=Je(),M[w].c(),M[w].m(a,null))}for(;w<M.length;w+=1)M[w].d(1);M.length=B.length}b[0].guessing?A&&(A.d(1),A=null):A?A.p(b,y):(A=Ze(b),A.c(),A.m(e,d)),y&2&&m!==(m=b[1].elo+"")&&ae(O,m),y&2&&K!==(K=b[1].n_pieces+"")&&ae(ne,K)},i:S,o:S,d(b){b&&C(e),W(E,b),W(M,b),A&&A.d()}}}function is(n,e,t){let{puzzle:s}=e,{game:i}=e;const r=()=>{t(0,i.guessing=!0,i),t(0,i.level++,i)},o=()=>{t(0,i.guessing=!0,i),t(0,i.level=1,i),t(0,i.fails=0,i)};return n.$$set=a=>{"puzzle"in a&&t(1,s=a.puzzle),"game"in a&&t(0,i=a.game)},[i,s,r,o]}class ns extends ie{constructor(e){super(),se(this,e,is,ss,te,{puzzle:1,game:0})}}function rs(n){return{c:S,m:S,p:S,i:S,o:S,d:S}}function os(n){let e,t,s,i,r,o,a;function l(h){n[3](h)}let c={puzzle:n[7]};n[0]!==void 0&&(c.game=n[0]),e=new ns({props:c}),ce.push(()=>Se(e,"game",l));const d=[ls,as],f=[];function u(h,k){return h[0].guessing?0:1}return i=u(n),r=f[i]=d[i](n),{c(){ee(e.$$.fragment),s=L(),r.c(),o=it()},m(h,k){X(e,h,k),x(h,s,k),f[i].m(h,k),x(h,o,k),a=!0},p(h,k){const m={};k&2&&(m.puzzle=h[7]),!t&&k&1&&(t=!0,m.game=h[0],ke(()=>t=!1)),e.$set(m);let O=i;i=u(h),i===O?f[i].p(h,k):(we(),F(f[O],1,1,()=>{f[O]=null}),ye(),r=f[i],r?r.p(h,k):(r=f[i]=d[i](h),r.c()),z(r,1),r.m(o.parentNode,o))},i(h){a||(z(e.$$.fragment,h),z(r),a=!0)},o(h){F(e.$$.fragment,h),F(r),a=!1},d(h){Q(e,h),h&&C(s),f[i].d(h),h&&C(o)}}}function as(n){let e,t,s;function i(o){n[5](o)}let r={puzzle:n[7]};return n[0]!==void 0&&(r.game=n[0]),e=new Kt({props:r}),ce.push(()=>Se(e,"game",i)),{c(){ee(e.$$.fragment)},m(o,a){X(e,o,a),s=!0},p(o,a){const l={};a&2&&(l.puzzle=o[7]),!t&&a&1&&(t=!0,l.game=o[0],ke(()=>t=!1)),e.$set(l)},i(o){s||(z(e.$$.fragment,o),s=!0)},o(o){F(e.$$.fragment,o),s=!1},d(o){Q(e,o)}}}function ls(n){let e,t,s,i,r;e=new Tt({props:{pieces:n[7].pieces}});function o(l){n[4](l)}let a={puzzle:n[7]};return n[0]!==void 0&&(a.game=n[0]),s=new Ot({props:a}),ce.push(()=>Se(s,"game",o)),{c(){ee(e.$$.fragment),t=L(),ee(s.$$.fragment)},m(l,c){X(e,l,c),x(l,t,c),X(s,l,c),r=!0},p(l,c){const d={};c&2&&(d.pieces=l[7].pieces),e.$set(d);const f={};c&2&&(f.puzzle=l[7]),!i&&c&1&&(i=!0,f.game=l[0],ke(()=>i=!1)),s.$set(f)},i(l){r||(z(e.$$.fragment,l),z(s.$$.fragment,l),r=!0)},o(l){F(e.$$.fragment,l),F(s.$$.fragment,l),r=!1},d(l){Q(e,l),l&&C(t),Q(s,l)}}}function cs(n){return{c:S,m:S,p:S,i:S,o:S,d:S}}function hs(n){let e,t,s,i={ctx:n,current:null,token:null,hasCatch:!1,pending:cs,then:os,catch:rs,value:7,blocks:[,,,]};return Le(t=n[1],i),{c(){e=_("div"),i.block.c(),g(e,"id","game")},m(r,o){x(r,e,o),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,s=!0},p(r,[o]){n=r,i.ctx=n,o&2&&t!==(t=n[1])&&Le(t,i)||pt(i,n,o)},i(r){s||(z(i.block),s=!0)},o(r){for(let o=0;o<3;o+=1){const a=i.blocks[o];F(a)}s=!1},d(r){r&&C(e),i.block.d(),i.token=null,i=null}}}function us(n,e,t){let s=1;const i=async()=>{const d=await fetch(`https://valenbel123.pythonanywhere.com/level/${s}`),f=await d.json();if(d.ok)return console.log(f),f;throw new Error(f)};let r=i(),o={failedMoveIndex:null,guessing:!0,level:s,lives:3,fails:0};function a(d){o=d,t(0,o)}function l(d){o=d,t(0,o)}function c(d){o=d,t(0,o)}return n.$$.update=()=>{n.$$.dirty&5&&s<o.level&&(t(2,s=o.level),t(1,r=i()))},[o,r,s,a,l,c]}class ds extends ie{constructor(e){super(),se(this,e,us,hs,te,{})}}function fs(n){let e,t;return e=new ds({}),{c(){ee(e.$$.fragment)},m(s,i){X(e,s,i),t=!0},p:S,i(s){t||(z(e.$$.fragment,s),t=!0)},o(s){F(e.$$.fragment,s),t=!1},d(s){Q(e,s)}}}class ps extends ie{constructor(e){super(),se(this,e,null,fs,te,{})}}new ps({target:document.getElementById("app")});
